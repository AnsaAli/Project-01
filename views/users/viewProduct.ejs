<%- include('../layout/header.ejs') %>
    <header>
        <div class="header-bottom sticky-bar sticky-white-bg">
            <div class="container">

                <div class="header-action-right">
                    <!-- <div class="search-style-2">
                <form action="#">
                    <select class="select-active">
                        <option>Search in</option>
                        <option>Fruits</option>
                        <option>Vegetables</option>
                        <option>Sprouts</option>
                        <option>Consumer Electronics</option>
                        <option>Jewelry & Accessories</option>
                        <option>Home & Garden</option>
                        <option>Luggage & Bags</option>
                        <option>Shoes</option>
                        <option>Mother & Kids</option>
                    </select>
                    <input type="text" placeholder="Search for items…">
                </form>
            </div> -->
                    <div class="header-action-2">
                        <div class="header-action-icon-2">
                            <a href="shop-wishlist.html">
                                <img class="svgInject" alt="GoEAsy" src="/assets/imgs/theme/icons/icon-heart.svg">
                                <span class="pro-count blue"></span>
                            </a>
                        </div>
                        <div class="header-action-icon-2">
                            <a class="mini-cart-icon" href=""> <span id="cartCount"></span>
                                <p class="pro-count "><img alt="GoEAsy" src="/assets/imgs/theme/icons/icon-cart.svg">
                                    Cart</p>
                            </a>

                            <div class="cart-dropdown-wrap cart-dropdown-hm2">
                                <ul id="cart-items-list">
                                    <!-- Cart items will be dynamically generated here -->
                                </ul>
                                <div class="shopping-cart-footer">
                                    <div class="shopping-cart-total">
                                        <h4>Total <span id="total-price">0.00</span></h4>
                                    </div>
                                    <div class="shopping-cart-button">
                                        <a href="">View cart</a>
                                        <a href="/checkOut">Checkout</a>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <section class="product-tabs section-padding position-relative wow fadeIn animated">

        <div class="container">
            <div class="tab-header" style="margin-top: 20px; margin-bottom: 20px;">

                <!-- <ul class="nav nav-tabs" id="myTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="nav-tab-one" data-bs-toggle="tab" data-bs-target="#tab-one"
                        type="button" role="tab" aria-controls="tab-one" aria-selected="true">Vegetables</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="nav-tab-two" data-bs-toggle="tab" data-bs-target="#tab-two"
                        type="button" role="tab" aria-controls="tab-two" aria-selected="false">Fruits</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="nav-tab-three" data-bs-toggle="tab" data-bs-target="#tab-three"
                        type="button" role="tab" aria-controls="tab-three" aria-selected="false">Sprouts</button>
                </li>
            </ul> -->
                <!-- <a href="#" class="view-more d-none d-md-flex">View More<i
                    class="fi-rs-angle-double-small-right"></i></a> -->

            </div>
            <!--End nav-tabs-->

            <div class="tab-content wow fadeIn animated" id="myTabContent">
                <div class="tab-pane fade show active" id="tab-one" role="tabpanel" aria-labelledby="tab-one">
                    <div class="row product-grid-4">

                        <!-- sorting buttons -->
                        <div class="col-12 mb-3">
                            <div class="btn-group" role="group" style="margin-top: 20px; margin-bottom: 20px;">
                                <a href="" class="btn m-2" style="border-radius: 5px;">Vegetables</a>
                                <a href="" class="btn m-2" style="border-radius: 5px;">Fruits</a>
                                <a href="" class="btn m-2" style="border-radius: 5px;">Sprouts</a>
                                <a href="/home?sort=low_to_high" class="btn m-2" style="border-radius: 5px;">Price: Low
                                    to High</a>
                                <a href="/home?sort=high_to_low" class="btn  m-2" style="border-radius: 5px;">Price:
                                    High to Low</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </section>

    <body>
        <div class="containerProduct">
            <%= productData.category.name%>
                <div class="product-images">
                    <% productData.images.forEach((image)=>{%>
                        <img src="<%= image.url %>" alt="Product Image">
                        <% }) %>
                </div>
                <div class="product-details">
                    <div class="product-name m-4">
                        <h4>
                            <%= productData.productName%>
                        </h4>
                    </div>


                    <div class="quantity-selector  m-4">
                        <label for="quantity">Available Quantities</label>
                        <div class="">
                            <% productData.weightOptions.forEach(option=> { %>
                                <div>
                                    <% if (productData.totalPrice> productData.offerPrice ) { %>
                                        <p>On Offer of <%= productData.offerPercentage %> %</p>
                                        <div class=""
                                            style="border: 1px solid #333; padding: 5px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">

                                            <a <% if ( productData.totalQuantity===0 ) { %> disabled
                                                <% } %>
                                                    href="#"
                                                    class="p-2"
                                                    style="font-size:20px;"
                                                    onclick="addToCart(
                                                    '<%= productData._id%>',
                                                        <%= option.weight %>,
                                                            <%= option.priceAfterDiscount.toFixed(2) %>,
                                                                '<%= productData.productName %>',
                                                                    <%= option.weight %>

                                                                        %>)">
                                                                        <span>
                                                                            <%= option.weight %>g :
                                                                        </span>
                                                                        <span>₹<%=
                                                                                option.priceAfterDiscount.toFixed(2)%>
                                                                        </span>
                                            </a>
                                        </div>
                                        <% }else { %>
                                            <div class=""
                                                style="border: 1px solid #333; padding: 5px; border-radius: 8px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center;">
                                                <a <% if (productData.totalQuantity===0) { %>disabled<% } %> href="#"
                                                        class="p-2"
                                                        style="font-size: 20px;"
                                                        onclick="addToCart(
                                                        '<%= productData._id %>',
                                                            <%= option.weight %>,
                                                                <%= option.weightPrice.toFixed(2) %>,
                                                                    '<%= productData.productName %>',
                                                                        <%= option.weight %>
                                                                            )">
                                                                            <span>
                                                                                <%= option.weight %>
                                                                                    g :
                                                                            </span>
                                                                            <span>₹<%= option.weightPrice.toFixed(2) %>
                                                                            </span>
                                                </a>
                                                <% } %>
                                            </div>
                                </div>
                                <% }) %>
                        </div>
                    </div>

                    <div class="product-description m-5 p-2">
                        <hr>
                        <h4 class="m-4">About <%= productData.productName%>
                        </h4>
                        <p>
                            <%= productData.description %>
                        </p>
                        <hr>
                        <h4 class="m-4">Health Benefits</h4>
                        <p>
                            <%= productData.nutritionalInfo %>
                        </p>
                        <hr>
                        <h4 class="m-4">Try this amazing recipes.</h4>
                        <p>
                            <%= productData.recipies %>
                        </p>
                    </div>
                </div>
        </div>

        <p>Related Products: here</p>
        <style>
            .containerProduct {
                max-width: 900px;
                margin: 30px auto;
                background-color: #fff;
                padding: 30px;
                border-radius: 8px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            }

            .cartAndWish .button-form {
                display: inline-block;
                margin-right: 10px;
            }

            img {
                max-width: 250px;
                transition: transform 0.3s ease;

            }

            .product-images img:hover {
                transform: scale(1.4);
            }


            .product-name {
                font-size: 24px;
                font-weight: bold;
                margin-bottom: 10px;
            }

            .product-description {
                margin-bottom: 20px;
            }

            .product-price {
                font-size: 20px;
                font-weight: bold;
                color: #333;
                margin-bottom: 10px;
            }

            .quantity-selector {
                margin-bottom: 20px;
            }

            .add-to-cart-btn {
                background-color: #4CAF50;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 4px;
                cursor: pointer;
                font-size: 16px;

            }

            /* Responsive CSS */
            @media screen and (max-width: 768px) {
                .container {
                    padding: 10px;
                }

                .product-image img {
                    width: 100%;
                }
            }

            @media screen and (max-width: 480px) {
                .product-name {
                    font-size: 20px;
                }

                .product-price {
                    font-size: 18px;
                }

                .add-to-cart-btn {
                    padding: 8px 16px;
                }
            }
        </style>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>

            function fetchCartItems() {
                $.get('/listCartItems', function (response) {
                    if (response.cartItems && response.cartItems.length > 0) {
                        // Clear existing cart items
                        $('#cart-items-list').empty();
                        let totalPrice = 0;
                        // Iterate over each cart item and append to the list
                        response.cartItems.forEach(function (item) {
                            const itemPrice = item.product.price * item.quantity;
                            totalPrice += itemPrice;
                            $('#cart-items-list').append(
                                `<li>
                        <div class="cart-item">
                            <img src="${item.product.images[0].url}" alt="${item.product.name}">
                            <div class="cart-item-details">
                                <h4>${item.product.name}</h4>
                                <p>Price: $${item.product.price}</p>
                                <p>Quantity: ${item.quantity}</p>
                                <p>Subtotal: $${itemPrice.toFixed(2)}</p>
                            </div>
                        </div>
                    </li>`
                            );
                        });
                        // Update total price
                        $('#total-price').text(totalPrice.toFixed(2));
                    } else {
                        // If cart is empty, display a message
                        $('#cart-items-list').html('<li>No items in cart</li>');
                        $('#total-price').text('0.00');
                    }
                }).fail(function () {
                    // Handle failure to fetch cart items
                    $('#cart-items-list').html('<li>Error fetching cart items</li>');
                    $('#total-price').text('0.00');
                });
            }


            function addToCart(productId, weight, price, productName) {
                // Prepare data to send to the server
                const data = {
                    productId: productId,
                    weight: weight,
                    price: price,
                    productName: productName
                };

                // Send AJAX request to the server
                fetch('/addToCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                })
                    .then(response => {
                        if (response.ok) {
                            // Handle successful response
                            console.log('Product added to cart successfully');
                        } else {
                            // Handle error response
                            console.error('Failed to add product to cart');
                        }
                    })
                    .catch(error => {
                        console.error('Error adding product to cart:', error);
                    });
            }

            fetchCartItems();
        </script>

    </body>



    <%- include('../layout/footer.ejs') %>