<%- include('../layout/header.ejs') %>
    <%- include('../layout/cartAndwishlist.ejs') %>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

      
        <body>
            
            
            <div class="containerProduct">
                <%= productData.category.name%>
                <div id="cart-indication" class="" style="color: #4CAF50; border: 1px solid #ffffff; padding: 10px; font-size: x-large;text-align: center;">
                    <div>
                       
                    </div>
                </div>
                
                    <div class="product-images">
                        <% productData.images.forEach((image)=>{%>
                            <img src="<%= image.url %>" alt="Product Image">
                            <% }) %>
                    </div>
                    <div class="product-details">
                        <div class="product-name m-4">
                            <h4>
                                <%= productData.productName%>
                            </h4>
                        </div>


                        <div class="quantity-selector  m-4">
                            <label for="quantity">Available Quantities</label>
                            <div class="">
                                <% let offerDisplayed=false; %>
                                    <% productData.weightOptions.forEach(option=> { %>
                                        <div>
                                            <% if (productData.totalPrice> productData.offerPrice && !offerDisplayed ) {
                                                %>

                                                <% offerDisplayed=true; %>
                                                    <p>on offer of : <strong>
                                                            <%= productData.offerPercentage %> %</p></strong>

                                                    <div class=""
                                                        style="border: 1px solid #333; padding: 5px; border-radius: 8px;  margin-bottom: 5px; ">

                                                        <a <% if ( productData.totalQuantity===0 ) { %> disabled <% } %>
                                                                href="#"
                                                                class="p-2 d-flex justify-content-between
                                                                align-items-center" style="font-size:20px;"
                                                                onclick="addToCart('<%= productData._id%>', <%=
                                                                        option.weight %>,<%=
                                                                            option.priceAfterDiscount.toFixed(2) %>,
                                                                            '<%= productData.productName %>', <%=
                                                                                    option.weight %> )">
                                                                                    <span>
                                                                                        weight:  <%= option.weight %>g 
                                                                                    </span>
                                                                                    <span>Price: ₹<%=
                                                                                            option.priceAfterDiscount.toFixed(2)%>
                                                                                    </span>
                                                                                    <span>
                                                                                        <i
                                                                                            class="fas fa-shopping-cart"></i>
                                                                                    </span>
                                                        </a>
                                                    </div>
                                                    <% }else { %>
                                                        <div class=""
                                                            style="border: 1px solid #333; padding: 5px; border-radius: 8px; margin-bottom: 5px; ">
                                                            <a <% if (productData.totalQuantity===0) { %>disabled<% } %>
                                                                    href="#"
                                                                    class="p-2 d-flex justify-content-between
                                                                    align-items-center"
                                                                    style="font-size: 20px;"
                                                                    onclick="addToCart( '<%= productData._id %>', <%=
                                                                            option.weight %>, <%=
                                                                                option.weightPrice.toFixed(2) %>,
                                                                                '<%= productData.productName %>', <%=
                                                                                        option.weight %>)">

                                                                                        <span>
                                                                                            weight:
                                                                                            <%= option.weight %>
                                                                                                g
                                                                                        </span>
                                                                                        <span>Price: ₹<%=
                                                                                                option.weightPrice.toFixed(2)
                                                                                                %>
                                                                                        </span>
                                                                                        <span>
                                                                                            <i
                                                                                                class="fas fa-shopping-cart"></i>
                                                                                        </span>
                                                            </a>
                                                            <% } %>
                                                        </div>
                                        </div>
                                        <% }) %>
                            </div>
                        </div>
                       
                        <div class="product-description m-5 p-2">
                            <hr>
                            <h4 class="m-4">About <%= productData.productName%>
                            </h4>
                            <p>
                                <%= productData.description %>
                            </p>
                            <hr>
                            <h4 class="m-4">Health Benefits</h4>
                            <p>
                                <%= productData.nutritionalInfo %>
                            </p>
                            <hr>
                            <h4 class="m-4">Try this amazing recipes.</h4>
                            <p>
                                <%= productData.recipies %>
                            </p>
                        </div>
                    </div>
            </div>

            <p>Related Products: here</p>
            <style>
                .containerProduct {
                    max-width: 900px;
                    margin: 30px auto;
                    background-color: #fff;
                    padding: 30px;
                    border-radius: 8px;
                    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                }

                .cartAndWish .button-form {
                    display: inline-block;
                    margin-right: 10px;
                }

                img {
                    max-width: 250px;
                    transition: transform 0.3s ease;

                }

                .product-images img:hover {
                    transform: scale(1.4);
                }


                .product-name {
                    font-size: 24px;
                    font-weight: bold;
                    margin-bottom: 10px;
                }

                .product-description {
                    margin-bottom: 20px;
                }

                .product-price {
                    font-size: 20px;
                    font-weight: bold;
                    color: #333;
                    margin-bottom: 10px;
                }

                .quantity-selector {
                    margin-bottom: 20px;
                }

                .add-to-cart-btn {
                    background-color: #4CAF50;
                    color: white;
                    padding: 10px 20px;
                    border: none;
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 16px;

                }

                /* Responsive CSS */
                @media screen and (max-width: 768px) {
                    .container {
                        padding: 10px;
                    }

                    .product-image img {
                        width: 100%;
                    }
                }

                @media screen and (max-width: 480px) {
                    .product-name {
                        font-size: 20px;
                    }

                    .product-price {
                        font-size: 18px;
                    }

                    .add-to-cart-btn {
                        padding: 8px 16px;
                    }
                }
            </style>

            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
            <script>

                function fetchCartItems() {
                    $.get('/listCartItems', function (response) {
                        if (response.cartItems && response.cartItems.length > 0) {
                            // Clear existing cart items
                            $('#cart-items-list').empty();
                            let totalPrice = 0;
                            // Iterate over each cart item and append to the list
                            response.cartItems.forEach(function (item) {
                                const itemPrice = item.product.price * item.quantity;
                                totalPrice += itemPrice;
                                $('#cart-items-list').append(
                                    `<li>
                        <div class="cart-item">
                            <img src="${item.product.images[0].url}" alt="${item.product.name}">
                            <div class="cart-item-details">
                                <h4>${item.product.name}</h4>
                                <p>Price: $${item.product.price}</p>
                                <p>Quantity: ${item.quantity}</p>
                                <p>Subtotal: $${itemPrice.toFixed(2)}</p>
                            </div>
                        </div>
                    </li>`
                                );
                            });
                            // Update total price
                            $('#total-price').text(totalPrice.toFixed(2));
                        } else {
                            // If cart is empty, display a message
                            $('#cart-items-list').html('<li>No items in cart</li>');
                            $('#total-price').text('0.00');
                        }
                    }).fail(function () {
                        // Handle failure to fetch cart items
                        $('#cart-items-list').html('<li>Error fetching cart items</li>');
                        $('#total-price').text('0.00');
                    });
                }


                function addToCart(productId, weight, price, productName) {
                    // Prepare data to send to the server
                    const data = {
                        productId: productId,
                        weight: weight,
                        price: price,
                        productName: productName
                    };

                    // Send AJAX request to the server
                    fetch('/addToCart', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    })
                        .then(response => {
                            if (response.ok) {
                                // Handle successful response
                                console.log('Product added to cart successfully');
                                showCartIndication('Product added to cart successfully');
                            } else {
                                // Handle error response
                                console.error('Failed to add product to cart');
                                showCartIndication('Failed to add product to cart', true);
                            }
                        })
                        .catch(error => {
                            console.error('Error adding product to cart:', error);
                            showCartIndication('Error adding product to cart', true);
                        });
                }

                fetchCartItems();

                function showCartIndication(message, isError = false) {
                    const indicationElement = document.getElementById('cart-indication');
                    indicationElement.textContent = message;
                    indicationElement.classList.toggle('error', isError);

                    // Clear indication after a delay
                    setTimeout(() => {
                        indicationElement.textContent = '';
                    }, 3000); // Change 3000 to adjust the duration of the indication
                }
            </script>

        </body>



        <%- include('../layout/footer.ejs') %>